[{"name":"app.R","content":"library(shiny)\nlibrary(tidyverse)\nlibrary(shinythemes)\nlibrary(DT)\nlibrary(gridExtra)\n\n\nif (FALSE) library(munsell)\n\nui <- navbarPage(\"PCA Dashboard\",\n                 theme = shinytheme(\"flatly\"),\n                 tabPanel(\"2D PCA Visualization\",\n                          fluidPage(\n                            sidebarLayout(\n                              sidebarPanel(\n                                h3(\"Variable Selection\"),\n                                selectInput(\"var1\", \n                                            \"Select X Variable:\",\n                                            choices = names(iris)[1:4],\n                                            selected = \"Sepal.Length\"),\n                                \n                                selectInput(\"var2\", \n                                            \"Select Y Variable:\",\n                                            choices = names(iris)[1:4],\n                                            selected = \"Sepal.Width\"),\n                                helpText(\"Tip 1: \n                                  Try selecting Sepal.Width and Sepal.Length to explore an example where the first principal component (PC1) captures the least variance.\"),\n                                \n                                helpText(\"Tip 2:\n                                  Try selecting Petal.Length and Petal.Width to explore an example where the first principal component (PC1) captures the most variance.\"),\n                                br(),\n                                h4(\"PCA Information\"),\n                                verbatimTextOutput(\"pca_summary\"),\n                                \n                                br(),\n                                h4(\"Variance Explained\"),\n                                verbatimTextOutput(\"variance_explained\")\n                              ),\n                              \n                              mainPanel(\n                                plotOutput(\"scatter_plot\", height = \"600px\"),\n                                fluidRow(\n                                  column(12,\n                                         h4(\"Interpretation\"),\n                                         textOutput(\"pca_explanation\")\n                                  )\n                                ),\n                                br(),\n                                br()\n                              )\n                            )\n                          )\n                 ),\n                 tabPanel(\"PCA Biplot\",\n                          fluidPage(\n                            sidebarLayout(\n                              sidebarPanel(\n                                h3(\"Full Dataset PCA\"),\n                                helpText(\"This biplot shows PCA performed on all 4 iris variables\"),\n                                br(),\n                                h4(\"Variance Explained by Each PC\"),\n                                verbatimTextOutput(\"full_pca_variance\"),\n                                br(),\n                                h4(\"Loadings (PC1 and PC2)\"),\n                                verbatimTextOutput(\"full_pca_loadings\")\n                              ),\n                              mainPanel(\n                                plotOutput(\"biplot\", height = \"600px\"),\n                                fluidRow(\n                                  column(12,\n                                         h4(\"Interpretation\"),\n                                         textOutput(\"Biplot_explanation\")\n                                  )\n                                ),\n                                br(),\n                                br()\n                              )\n                            )\n                          )\n                 ),\n                 tabPanel(\"Scree Plot\",\n                          fluidPage(\n                            sidebarLayout(\n                              sidebarPanel(\n                                h3(\"Scree Plot Analysis\"),\n                                helpText(\"The scree plot shows the variance explained by each principal component. Look for the 'elbow' point where the curve levels off.\"),\n                                br(),\n                                h4(\"Variance Summary\"),\n                                verbatimTextOutput(\"scree_variance_summary\"),\n                                br(),\n                              ),\n                              mainPanel(\n                                plotOutput(\"scree_plot\", height = \"600px\"),\n                                fluidRow(\n                                  column(12,\n                                         h4(\"Interpretation\"),\n                                         textOutput(\"scree_explanation\")\n                                  )\n                                ),\n                                br(),\n                                br()\n                                \n                              )\n                            )\n                          )\n                 ),\n                 tabPanel(\"Reconstruction & Information Loss\",\n                          fluidPage(\n                            sidebarLayout(\n                              sidebarPanel(\n                                radioButtons(\"dataset\", \"Dataset: \",\n                                  choices = list(\n                                    \"IRIS Data - 4 Variables\" = \"iris_dataset\",\n                                    \"Diamonds Dataset - 7 Variables\" = \"diamonds_dataset\"\n                                  ),\n                                  selected = \"iris_dataset\"),\n                                h3(\"Data Reconstruction\"),\n                                helpText(\"See how well the original data can be reconstructed using different numbers of principal components.\"),\n                                br(),\n                                sliderInput(\"n_components\",\n                                            \"Number of Principal Components to Use:\",\n                                            min = 1, max = 4, value = 4, step = 1),\n                                br(),\n                                h4(\"Reconstruction Quality\"),\n                                verbatimTextOutput(\"reconstruction_quality\"),\n                                br(),\n                                h4(\"Information Loss\"),\n                                verbatimTextOutput(\"information_loss\"),\n                                br(),\n                              ),\n                              mainPanel(\n                                plotOutput(\"reconstruction_plots\", height = \"800px\"),\n                                fluidRow(\n                                  column(12,\n                                         h4(\"Interpretation\"),\n                                         textOutput(\"information_loss_explanation\")\n                                  )\n                                ),\n                                br(),\n                                br()\n                              )\n                            )\n                          )\n                 ),\n                 footer = tags$footer(\n                   style = \"\n                    position: fixed;\n                    bottom: 0;\n                    left: 0;\n                    width: 100%;\n                    background-color: #f8f9fa;\n                    border-top: 1px solid #ddd;\n                    text-align: center;\n                    padding: 8px;\n                    font-size: 12px;\n                    color: #6c757d;\n                    z-index: 1000;\n                  \",\n                   \"2025 Created by Shahriar Shams and Issey Sone\"\n                 )\n)\n\nserver <- function(input, output, session) {\n  data(\"diamonds\")\n  set.seed(123)\n  numeric_diamonds <- diamonds[sapply(diamonds, is.numeric)]\n  numeric_diamonds <- numeric_diamonds[sample(nrow(numeric_diamonds), 2000), ]\n  rownames(numeric_diamonds) <- NULL\n  \n  \n  \n  selected_data <- reactive({\n    data.frame(\n      x = iris[[input$var1]],\n      y = iris[[input$var2]],\n      Species = iris$Species\n    )\n  })\n  \n  \n  current_dataset <- reactive({\n    if(input$dataset == \"iris_dataset\") {\n      list(\n        data = iris[, 1:4],\n        name = \"IRIS\",\n        n_vars = 4,\n        var_names = c(\"Sepal.Length\", \"Sepal.Width\", \"Petal.Length\", \"Petal.Width\")\n      )\n    } else {\n      list(\n        data = numeric_diamonds,\n        name = \"Diamonds\",\n        n_vars = ncol(numeric_diamonds),\n        var_names = names(numeric_diamonds)\n      )\n    }\n  })\n  \n  \n  observe({\n    dataset_info <- current_dataset()\n    updateSliderInput(session, \"n_components\",\n                      max = dataset_info$n_vars,\n                      value = min(input$n_components, dataset_info$n_vars))\n  })\n  \n  \n  \n  pca_result <- reactive({\n    data_matrix <- selected_data()[, c(\"x\", \"y\")]\n    prcomp(data_matrix, center = TRUE, scale. = TRUE)\n  })\n  \n  full_pca_result <- reactive({\n    data_matrix <- iris[, 1:4]  # All 4 numeric variables\n    prcomp(data_matrix, center = TRUE, scale. = TRUE)\n  })\n  \n  current_pca_result <- reactive({\n    dataset_info <- current_dataset()\n    data_matrix <- dataset_info$data\n    prcomp(data_matrix, center = TRUE, scale. = TRUE)\n  })\n  \n  output$pca_summary <- renderText({\n    pca <- pca_result()\n    paste(\"Principal Component 1 (PC1):\\n\",\n          sprintf(\"%.3f * %s + %.3f * %s\\n\\n\", \n                  pca$rotation[1,1], input$var1,\n                  pca$rotation[2,1], input$var2),\n          \"Principal Component 2 (PC2):\\n\",\n          sprintf(\"%.3f * %s + %.3f * %s\", \n                  pca$rotation[1,2], input$var1,\n                  pca$rotation[2,2], input$var2))\n  })\n  \n  output$variance_explained <- renderText({\n    pca <- pca_result()\n    var_exp <- summary(pca)$importance[2,] * 100\n    paste(\"PC1 explains:\", sprintf(\"%.1f%%\", var_exp[1]), \"of variance\\n\",\n          \"PC2 explains:\", sprintf(\"%.1f%%\", var_exp[2]), \"of variance\\n\",\n          \"Total explained:\", sprintf(\"%.1f%%\", sum(var_exp)))\n  })\n  \n  output$full_pca_variance <- renderText({\n    pca <- full_pca_result()\n    var_exp <- summary(pca)$importance[2,] * 100\n    paste(\"PC1:\", sprintf(\"%.1f%%\", var_exp[1]), \"\\n\",\n          \"PC2:\", sprintf(\"%.1f%%\", var_exp[2]), \"\\n\",\n          \"PC3:\", sprintf(\"%.1f%%\", var_exp[3]), \"\\n\",\n          \"PC4:\", sprintf(\"%.1f%%\", var_exp[4]), \"\\n\",\n          \"Cumulative (PC1+PC2):\", sprintf(\"%.1f%%\", sum(var_exp[1:2])))\n  })\n  \n  output$scree_variance_summary <- renderText({\n    pca <- full_pca_result()\n    var_exp <- summary(pca)$importance[2,] * 100\n    cum_var <- cumsum(var_exp)\n    \n    paste(\"Individual Variance:\\n\",\n          sprintf(\"PC1: %.1f%%\\n\", var_exp[1]),\n          sprintf(\"PC2: %.1f%%\\n\", var_exp[2]),\n          sprintf(\"PC3: %.1f%%\\n\", var_exp[3]),\n          sprintf(\"PC4: %.1f%%\\n\\n\", var_exp[4]),\n          \"Cumulative Variance:\\n\",\n          sprintf(\"PC1: %.1f%%\\n\", cum_var[1]),\n          sprintf(\"PC1-PC2: %.1f%%\\n\", cum_var[2]),\n          sprintf(\"PC1-PC3: %.1f%%\\n\", cum_var[3]),\n          sprintf(\"PC1-PC4: %.1f%%\", cum_var[4]))\n  })\n  \n  output$full_pca_loadings <- renderText({\n    pca <- full_pca_result()\n    loadings <- pca$rotation[, 1:2]\n    \n    paste(\"PC1 Loadings:\\n\",\n          sprintf(\"Sepal.Length: %.3f\\n\", loadings[1,1]),\n          sprintf(\"Sepal.Width:  %.3f\\n\", loadings[2,1]),\n          sprintf(\"Petal.Length: %.3f\\n\", loadings[3,1]),\n          sprintf(\"Petal.Width:  %.3f\\n\\n\", loadings[4,1]),\n          \"PC2 Loadings:\\n\",\n          sprintf(\"Sepal.Length: %.3f\\n\", loadings[1,2]),\n          sprintf(\"Sepal.Width:  %.3f\\n\", loadings[2,2]),\n          sprintf(\"Petal.Length: %.3f\\n\", loadings[3,2]),\n          sprintf(\"Petal.Width:  %.3f\", loadings[4,2]))\n  })\n  \n  output$scatter_plot <- renderPlot({\n    data <- selected_data()\n    pca <- pca_result()\n    \n    center_x <- mean(data$x)\n    center_y <- mean(data$y)\n    \n    pc1_dir <- pca$rotation[,1]\n    pc2_dir <- pca$rotation[,2]\n    \n    pc1_sd <- pca$sdev[1]\n    pc2_sd <- pca$sdev[2]\n    \n    scale_factor <- min(sd(data$x), sd(data$y)) * 2\n    \n    pc1_end_x <- center_x + pc1_dir[1] * pc1_sd * scale_factor\n    pc1_end_y <- center_y + pc1_dir[2] * pc1_sd * scale_factor\n    pc1_start_x <- center_x - pc1_dir[1] * pc1_sd * scale_factor\n    pc1_start_y <- center_y - pc1_dir[2] * pc1_sd * scale_factor\n    \n    pc2_end_x <- center_x + pc2_dir[1] * pc2_sd * scale_factor\n    pc2_end_y <- center_y + pc2_dir[2] * pc2_sd * scale_factor\n    pc2_start_x <- center_x - pc2_dir[1] * pc2_sd * scale_factor\n    pc2_start_y <- center_y - pc2_dir[2] * pc2_sd * scale_factor\n    \n    p <- ggplot(data, aes(x = x, y = y, color = Species)) +\n      geom_point(size = 3, alpha = 0.7) +\n      \n      geom_segment(aes(x = pc1_start_x, y = pc1_start_y, \n                       xend = pc1_end_x, yend = pc1_end_y),\n                   color = \"red\", size = 1.0, alpha = 0.8,\n                   arrow = arrow(length = unit(0.3, \"cm\"), ends = \"both\")) +\n      \n      geom_segment(aes(x = pc2_start_x, y = pc2_start_y, \n                       xend = pc2_end_x, yend = pc2_end_y),\n                   color = \"blue\", size = 1.0, alpha = 0.8,\n                   arrow = arrow(length = unit(0.3, \"cm\"), ends = \"both\")) +\n      \n      geom_point(aes(x = center_x, y = center_y), \n                 color = \"black\", size = 2, shape = 3) +\n      \n      labs(title = paste(\"PCA Analysis:\", input$var1, \"vs\", input$var2),\n           subtitle = \"Red: PC1 (Major Axis), Blue: PC2 (Minor Axis)\",\n           x = input$var1,\n           y = input$var2) +\n      \n      theme_minimal() +\n      theme(plot.title = element_text(size = 16, hjust = 0.5),\n            plot.subtitle = element_text(size = 12, hjust = 0.5),\n            legend.position = \"bottom\") +\n      \n      scale_color_manual(values = c(\"setosa\" = \"#E69F00\", \n                                    \"versicolor\" = \"#56B4E9\", \n                                    \"virginica\" = \"#009E73\"))\n    \n    print(p)\n  })\n  \n  # Interpretations\n  \n  output$pca_explanation <- renderText({\n    \"PCA is only being performed on two variables here. The red line (PC1) shows the direction of maximum variance in the data, while the blue line (PC2) is orthagonal to PC1 and\n    represents the second highest variance direction. Projecting the data onto those axes transforms the variances into uncorrelated\n    components ranked by how much variance they capture. Each principal component is a linear combination of the original variables, the coefficient is the loading value, which\n    defines the rotation of the new axes. Unlike a regression line, the principal component axis does not aim to fit or pass through all data points,\n    it identifies the direction in which the data has the greatest variance.\"\n  })\n  \n  output$Biplot_explanation <- renderText({\n    \"Red arrow represents how each of the original variables contributes to the principal components.\n    Petal.Length and Petal.Width point in the same direction and are relatively long so they are highly correlated\n    and influence PC1 the most. Sepal.Width is negatively correlated and contributes more to PC2. Each arrow is drawn as\n    (x, y) = (loading PC1 * k, loading PC2 * k) where k is a scaling factor.\"\n  })\n  \n  output$scree_explanation <- renderText({\n    \"The Scree plot shows how much individual variance is contributed by each principal component. Typically you want to look for the elbow point which\n    is where the plot shows a sharp drop followed by a flattened shape. In our example its PC2.\"\n  })\n  \n  output$information_loss_explanation <- renderText({\n    \"Each scatter plot compared the original variable values (x-axis) to teh values reconstructed from the selected number of PCs (y-axis). Points closer to the red diagonal line\n    indicate better reconstruction accuracy. Using more prinicpal componetns captures more of the dataset's variance which improves the reconstruction. High R^2 values and low RMSE values\n    indicate good reconstruction quality for that particular variable. The % of variance retained in the amount of variance retained in the lower-dimensional representation.\"\n  })\n  \n  output$scree_plot <- renderPlot({\n    pca <- full_pca_result()\n    \n    var_exp <- summary(pca)$importance[2,] * 100\n    cum_var <- cumsum(var_exp)\n    \n    scree_data <- data.frame(\n      PC = factor(1:4, labels = paste0(\"PC\", 1:4)),\n      Variance = var_exp,\n      Cumulative = cum_var\n    )\n    \n    p1 <- ggplot(scree_data, aes(x = PC, y = Variance, group = 1)) +\n      geom_line(size = 1.2, color = \"skyblue\") +\n      geom_point(size = 4, color = \"skyblue\") +\n      labs(title = \"Scree Plot - Variance Explained by Each PC\",\n           x = \"Principal Component\",\n           y = \"Variance Explained (%)\") +\n      theme_minimal() +\n      theme(plot.title = element_text(size = 14, hjust = 0.5),\n            axis.text.x = element_text(size = 12),\n            axis.text.y = element_text(size = 12)) +\n      ylim(0, max(var_exp) + 5)\n    \n    p2 <- ggplot(scree_data, aes(x = PC, y = Cumulative, group = 1)) +\n      geom_line(size = 1.2, color = \"red\") +\n      geom_point(size = 4, color = \"red\") +\n      geom_hline(yintercept = 80, linetype = \"dashed\", color = \"gray\", alpha = 0.7) +\n      geom_hline(yintercept = 95, linetype = \"dashed\", color = \"gray\", alpha = 0.7) +\n      labs(title = \"Cumulative Variance Explained\",\n           x = \"Principal Component\",\n           y = \"Cumulative Variance (%)\") +\n      theme_minimal() +\n      theme(plot.title = element_text(size = 14, hjust = 0.5),\n            axis.text.x = element_text(size = 12),\n            axis.text.y = element_text(size = 12)) +\n      ylim(0, 100) +\n      annotate(\"text\", x = 3.5, y = 82, label = \"80%\", color = \"gray\", size = 3) +\n      annotate(\"text\", x = 3.5, y = 97, label = \"95%\", color = \"gray\", size = 3)\n    \n    grid.arrange(p1, p2, ncol = 1)\n  })\n  \n  reconstructed_data <- reactive({\n    pca <- full_pca_result()\n    n_comp <- input$n_components\n    \n    scores <- pca$x[, 1:n_comp, drop = FALSE]\n    loadings <- pca$rotation[, 1:n_comp, drop = FALSE]\n    \n    reconstructed_scaled <- scores %*% t(loadings)\n    \n    reconstructed <- scale(reconstructed_scaled, center = FALSE, scale = 1/pca$scale) + \n      matrix(rep(pca$center, each = nrow(reconstructed_scaled)), ncol = 4)\n    \n    colnames(reconstructed) <- c(\"Sepal.Length\", \"Sepal.Width\", \"Petal.Length\", \"Petal.Width\")\n    as.data.frame(reconstructed)\n  })\n  \n  output$reconstruction_quality <- renderText({\n    original <- iris[, 1:4]\n    reconstructed <- reconstructed_data()\n    n_comp <- input$n_components\n    \n    r_squared <- sapply(1:4, function(i) {\n      cor(original[,i], reconstructed[,i])^2\n    })\n    \n    rmse <- sapply(1:4, function(i) {\n      sqrt(mean((original[,i] - reconstructed[,i])^2))\n    })\n    \n    var_names <- c(\"Sepal.Length\", \"Sepal.Width\", \"Petal.Length\", \"Petal.Width\")\n    \n    paste(\"Using\", n_comp, \"component(s):\\n\\n\",\n          \"R² Values:\\n\",\n          paste(sprintf(\"%s: %.3f\", var_names, r_squared), collapse = \"\\n\"),\n          \"\\n\\nRMSE Values:\\n\",\n          paste(sprintf(\"%s: %.3f\", var_names, rmse), collapse = \"\\n\"),\n          \"\\n\\nMean R²:\", sprintf(\"%.3f\", mean(r_squared)),\n          \"\\nMean RMSE:\", sprintf(\"%.3f\", mean(rmse)))\n  })\n  \n  output$information_loss <- renderText({\n    pca <- full_pca_result()\n    n_comp <- input$n_components\n    \n    var_exp <- summary(pca)$importance[2,] * 100\n    retained_var <- sum(var_exp[1:n_comp])\n    lost_var <- 100 - retained_var\n    \n    paste(\"Variance Analysis:\\n\",\n          sprintf(\"Retained: %.1f%%\\n\", retained_var),\n          sprintf(\"Lost: %.1f%%\\n\", lost_var),\n          sprintf(\"Information Loss: %.1f%%\", lost_var))\n  })\n  \n  \n  reconstructed_data <- reactive({\n    dataset_info <- current_dataset()\n    pca <- current_pca_result()\n    n_comp <- input$n_components\n    \n    scores <- pca$x[, 1:n_comp, drop = FALSE]\n    loadings <- pca$rotation[, 1:n_comp, drop = FALSE]\n    \n    reconstructed_scaled <- scores %*% t(loadings)\n    \n    reconstructed <- scale(reconstructed_scaled, center = FALSE, scale = 1/pca$scale) +\n      matrix(rep(pca$center, each = nrow(reconstructed_scaled)), ncol = dataset_info$n_vars)\n    \n    colnames(reconstructed) <- dataset_info$var_names\n    as.data.frame(reconstructed)\n  })\n  \n  output$reconstruction_quality <- renderText({\n    dataset_info <- current_dataset()\n    original <- dataset_info$data\n    reconstructed <- reconstructed_data()\n    n_comp <- input$n_components\n    n_vars <- dataset_info$n_vars\n    \n    \n    \n    r_squared <- numeric(n_vars)\n    rmse <- numeric(n_vars)\n    \n    for (i in 1:n_vars) {\n      orig_col <- as.numeric(original[[i]])\n      recon_col <- as.numeric(reconstructed[[i]])\n      \n      if (all(is.finite(orig_col)) && all(is.finite(recon_col))) {\n        r_squared[i] <- cor(orig_col, recon_col)^2\n        rmse[i] <- sqrt(mean((orig_col - recon_col)^2))\n      } else {\n        r_squared[i] <- NA\n        rmse[i] <- NA\n      }\n    }\n    \n    var_names <- dataset_info$var_names\n    \n    paste(\"Dataset:\", dataset_info$name, \"\\n\",\n          \"Using\", n_comp, \"component(s) out of\", dataset_info$n_vars, \"total:\\n\\n\",\n          \"R² Values:\\n\",\n          paste(sprintf(\"%s: %.3f\", var_names, r_squared), collapse = \"\\n\"),\n          \"\\n\\nRMSE Values:\\n\",\n          paste(sprintf(\"%s: %.3f\", var_names, rmse), collapse = \"\\n\"),\n          \"\\n\\nMean R²:\", sprintf(\"%.3f\", mean(r_squared)),\n          \"\\nMean RMSE:\", sprintf(\"%.3f\", mean(rmse)))\n  })\n  \n  output$information_loss <- renderText({\n    dataset_info <- current_dataset()\n    pca <- current_pca_result()\n    n_comp <- input$n_components\n    \n    var_exp <- summary(pca)$importance[2, ] * 100\n    \n    retained_var <- sum(var_exp[1:n_comp])\n    lost_var <- 100 - retained_var\n    \n    paste(\"Variance Analysis for\", dataset_info$name, \"Dataset:\\n\",\n          sprintf(\"Components used: %d out of %d\\n\", n_comp, dataset_info$n_vars),\n          sprintf(\"Retained: %.1f%%\\n\", retained_var),\n          sprintf(\"Information Loss: %.1f%%\", lost_var))\n    \n    \n  })\n  \n  output$reconstruction_plots <- renderPlot({\n    dataset_info <- current_dataset()\n  \n    original <- dataset_info$data \n    reconstructed <- reconstructed_data()\n    n_comp <- input$n_components\n    \n    var_names <- dataset_info$var_names\n    n_vars <- dataset_info$n_vars\n    \n    plot_list <- list()\n    \n    n_cols <- ifelse(n_vars <= 4, 2, 3)\n    n_rows <- ceiling(n_vars / n_cols)\n    \n    for(i in 1:n_vars) {\n      \n      original_vec <- as.numeric(original[[i]])\n      reconstructed_vec <- as.numeric(reconstructed[[i]])\n      \n      r_squared <- cor(original_vec, reconstructed_vec)^2\n      rmse <- sqrt(mean((original_vec - reconstructed_vec)^2))\n      \n     \n      \n      plot_data <- data.frame(\n        Original = original_vec,\n        Reconstructed = reconstructed_vec\n      )\n      \n      if(dataset_info$name == \"IRIS\") {\n        plot_data$Group <- iris$Species\n        color_mapping <- c(\"setosa\" = \"#E69F00\", \"versicolor\" = \"#56B4E9\", \"virginica\" = \"#009E73\")\n      } else {\n        plot_data$Group <- diamonds$cut[1:nrow(plot_data)]\n        color_mapping <- c(\"Fair\" = \"#E69F00\", \"Good\" = \"#56B4E9\", \"Very Good\" = \"#009E73\", \n                           \"Premium\" = \"#CC79A7\", \"Ideal\" = \"#D55E00\")\n      }\n      \n      p <- ggplot(plot_data, aes(x = Original, y = Reconstructed, color = Group)) +\n        geom_point(size = 1.5, alpha = 0.7) +\n        geom_abline(slope = 1, intercept = 0, linetype = \"dashed\", color = \"black\", alpha = 0.5) +\n        geom_smooth(method = \"lm\", se = FALSE, color = \"red\", size = 0.8) +\n        labs(title = paste0(var_names[i], \" (\", n_comp, \" PC\", ifelse(n_comp > 1, \"s\", \"\"), \")\"),\n             subtitle = sprintf(\"R² = %.3f, RMSE = %.3f\", r_squared, rmse),\n             x = \"Original Values\",\n             y = \"Reconstructed Values\") +\n        theme_minimal() +\n        theme(plot.title = element_text(size = 12, hjust = 0.5),\n              plot.subtitle = element_text(size = 10, hjust = 0.5),\n              legend.position = \"none\") +\n        scale_color_manual(values = color_mapping) +\n        coord_fixed()\n      \n      plot_list[[i]] <- p\n    }\n    \n    do.call(grid.arrange, c(plot_list, ncol = n_cols))\n  })\n  \n  output$biplot <- renderPlot({\n    pca <- full_pca_result()\n    \n    pca_scores <- data.frame(\n      PC1 = pca$x[,1], \n      PC2 = pca$x[,2], \n      Species = iris$Species\n    )\n    \n    loadings <- pca$rotation[, 1:2]\n    \n    arrow_scale <- 3\n    \n    p <- ggplot(pca_scores, aes(x = PC1, y = PC2, color = Species)) +\n      geom_point(size = 3, alpha = 0.7) +\n      \n      geom_segment(aes(x = 0, y = 0, \n                       xend = loadings[1,1] * arrow_scale, \n                       yend = loadings[1,2] * arrow_scale),\n                   color = \"red\", size = 1,\n                   arrow = arrow(length = unit(0.3, \"cm\"))) +\n      \n      geom_segment(aes(x = 0, y = 0, \n                       xend = loadings[2,1] * arrow_scale, \n                       yend = loadings[2,2] * arrow_scale),\n                   color = \"red\", size = 1,\n                   arrow = arrow(length = unit(0.3, \"cm\"))) +\n      \n      geom_segment(aes(x = 0, y = 0, \n                       xend = loadings[3,1] * arrow_scale, \n                       yend = loadings[3,2] * arrow_scale),\n                   color = \"red\", size = 1,\n                   arrow = arrow(length = unit(0.3, \"cm\"))) +\n      \n      geom_segment(aes(x = 0, y = 0, \n                       xend = loadings[4,1] * arrow_scale, \n                       yend = loadings[4,2] * arrow_scale),\n                   color = \"red\", size = 1,\n                   arrow = arrow(length = unit(0.3, \"cm\"))) +\n      \n      geom_text(aes(x = loadings[1,1] * (arrow_scale + 0.5), \n                    y = loadings[1,2] * (arrow_scale + 0.5),\n                    label = \"Sepal.Length\"),\n                color = \"red\", size = 4, fontface = \"bold\") +\n      \n      geom_text(aes(x = loadings[2,1] * (arrow_scale + 0.5), \n                    y = loadings[2,2] * (arrow_scale + 0.5),\n                    label = \"Sepal.Width\"),\n                color = \"red\", size = 4, fontface = \"bold\") +\n      \n      geom_text(aes(x = loadings[3,1] * (arrow_scale + 0.5), \n                    y = loadings[3,2] * (arrow_scale + 0.5),\n                    label = \"Petal.Length\"),\n                color = \"red\", size = 4, fontface = \"bold\") +\n      \n      geom_text(aes(x = loadings[4,1] * (arrow_scale + 0.5), \n                    y = loadings[4,2] * (arrow_scale + 0.5),\n                    label = \"Petal.Width\"),\n                color = \"red\", size = 4, fontface = \"bold\") +\n      \n      labs(title = \"PCA Biplot - Full Iris Dataset\",\n           subtitle = \"All 4 variables shown as red arrows with loadings\",\n           x = paste0(\"PC1 (\", sprintf(\"%.1f%%\", summary(pca)$importance[2,1] * 100), \" variance)\"),\n           y = paste0(\"PC2 (\", sprintf(\"%.1f%%\", summary(pca)$importance[2,2] * 100), \" variance)\")) +\n      \n      theme_minimal() +\n      theme(plot.title = element_text(size = 16, hjust = 0.5),\n            plot.subtitle = element_text(size = 12, hjust = 0.5),\n            legend.position = \"bottom\") +\n      \n      scale_color_manual(values = c(\"setosa\" = \"#E69F00\", \n                                    \"versicolor\" = \"#56B4E9\", \n                                    \"virginica\" = \"#009E73\")) +\n      \n      geom_hline(yintercept = 0, linetype = \"dashed\", alpha = 0.5) +\n      geom_vline(xintercept = 0, linetype = \"dashed\", alpha = 0.5)\n    \n    print(p)\n  })\n  \n}\n\nshinyApp(ui = ui, server = server)","type":"text"}]
